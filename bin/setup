#!/bin/sh

. .env

if [ ! -f .env.email ]; then
  echo "Missing email config file: .env.email"
  echo "\tIt must exist and set env var WP_ADMIN_EMAIL to some email address."
  echo "\tIt's not checked in to git. It's .gitignore'd."
  exit 1
else
  . .env.email
fi

rc=`curl \
  --write-out '%{http_code}' \
  --silent \
  --output /dev/null \
  "http://$WP_DOMAIN/wp-admin/install.php?step=2" \
  --data-urlencode "weblog_title=$WP_DOMAIN"\
  --data-urlencode "user_name=$WP_ADMIN_USERNAME" \
  --data-urlencode "admin_email=$WP_ADMIN_EMAIL" \
  --data-urlencode "admin_password=$WP_ADMIN_PASSWORD" \
  --data-urlencode "admin_password2=$WP_ADMIN_PASSWORD" \
  --data-urlencode "pw_weak=1"`

if [ "$rc" == "200" ]; then
  echo "SUCCESS"
  exit 0
else
  echo "FAIL with HTTP $rc"
  exit 1
fi
